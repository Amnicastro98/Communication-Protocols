# SPI Basics Quick Reference

## Table of Contents
- [Introduction](#introduction)
- [SPI Signals](#spi-signals)
- [SPI Modes](#spi-modes)
- [Basic Communication](#basic-communication)
- [Example Code](#example-code)

## Introduction
SPI (Serial Peripheral Interface) is a synchronous serial communication protocol used for short-distance communication between microcontrollers and peripheral devices. It operates in full-duplex mode, meaning data can be sent and received simultaneously. SPI is commonly used in embedded systems for connecting sensors, displays, and other peripherals.

Key characteristics:
- Master-slave architecture
- Synchronous (uses clock signal)
- Full-duplex communication
- No addressing (chip select signals used for device selection)
- High-speed compared to I2C

## SPI Signals
SPI uses four main signals:
- **MOSI (Master Out Slave In)**: Data line from master to slave
- **MISO (Master In Slave Out)**: Data line from slave to master
- **SCK (Serial Clock)**: Clock signal generated by master
- **SS/CS (Slave Select/Chip Select)**: Active-low signal to select which slave device to communicate with

```
Master                    Slave
  |                        |
  |---MOSI---------------> |
  |<---MISO--------------- |
  |---SCK----------------> |
  |---SS/CS--------------> |
```

## SPI Modes
SPI has four modes determined by the clock polarity (CPOL) and clock phase (CPHA):

- **Mode 0 (CPOL=0, CPHA=0)**: Clock idle low, data sampled on rising edge
- **Mode 1 (CPOL=0, CPHA=1)**: Clock idle low, data sampled on falling edge
- **Mode 2 (CPOL=1, CPHA=0)**: Clock idle high, data sampled on falling edge
- **Mode 3 (CPOL=1, CPHA=1)**: Clock idle high, data sampled on rising edge

The mode must match between master and slave devices.

## Basic Communication
1. Master pulls SS/CS low to select the slave
2. Master sends clock pulses on SCK
3. Data is shifted out on MOSI and in on MISO simultaneously
4. Master pulls SS/CS high to deselect the slave

Data is typically transmitted MSB (Most Significant Bit) first.

## Example Code
```c
#include <avr/io.h>  // AVR microcontroller header
#include <util/delay.h>

// SPI Pins (for AVR ATMega328P)
#define MOSI PB3
#define MISO PB4
#define SCK PB5
#define SS PB2

// Initialize SPI as Master
void SPI_MasterInit(void) {
    // Set MOSI, SCK, SS as output
    DDRB |= (1 << MOSI) | (1 << SCK) | (1 << SS);
    // Set MISO as input
    DDRB &= ~(1 << MISO);
    
    // Enable SPI, Master mode, set clock rate fck/16
    SPCR = (1 << SPE) | (1 << MSTR) | (1 << SPR0);
}

// Transmit and receive a byte
uint8_t SPI_MasterTransmit(uint8_t data) {
    // Start transmission
    SPDR = data;
    // Wait for transmission complete
    while (!(SPSR & (1 << SPIF)));
    // Return received data
    return SPDR;
}

// Example usage
int main(void) {
    SPI_MasterInit();
    
    // Select slave (pull SS low)
    PORTB &= ~(1 << SS);
    
    // Send and receive data
    uint8_t received = SPI_MasterTransmit(0xAA);
    
    // Deselect slave (pull SS high)
    PORTB |= (1 << SS);
    
    while(1);
    return 0;
}
